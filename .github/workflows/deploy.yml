name: Deploy to CapRover

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    # 1. Checkout your repository
    - name: Checkout code
      uses: actions/checkout@v4

    # 2. Install CapRover CLI
    - name: Install CapRover CLI
      run: npm install -g caprover

    # 3. Login to CapRover (using --caproverUrl to avoid captain.<ip> issue)
    - name: Login to CapRover
      run: |
        caprover login \
          --caproverUrl http://34.122.198.221:3000 \
          -p ${{ secrets.CAPROVER_PASSWORD }} \
          -n mycaprover

    # 4. Deploy Frontend
    - name: Deploy Frontend
      run: |
        caprover deploy \
          -n new-frontend \
          -b ./frontend \
          --caproverName mycaprover

    # 5. Deploy Go Backend
    - name: Deploy Go Backend
      run: |
        caprover deploy \
          -n new-backend-go \
          -b ./backend-go \
          --caproverName mycaprover

    # 6. Deploy Python Backend
    - name: Deploy Python Backend
      run: |
        caprover deploy \
          -n new-backend-python \
          -b ./backend-python \
          --caproverName mycaprover
